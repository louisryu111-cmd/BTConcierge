<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Banyan Tree Busan Concierge</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        :root { --primary-color: #8E7958; --bg-color: #121212; --card-bg: #1E1E1E; --text-color: #FFFFFF; }
        body { margin: 0; padding: 0; background-color: #000; font-family: 'Noto Sans KR', sans-serif; color: var(--text-color); -webkit-tap-highlight-color: transparent; }
        #app-container { max-width: 480px; margin: 0 auto; background-color: var(--bg-color); height: 100vh; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        
        /* --- 1. 초기 인증 선택 화면 --- */
        #auth-selection-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 1500; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* --- 2. 안면인식/코드화면 공통 --- */
        #security-screen, #code-auth-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 1400; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .logo-intro { font-size: 22px; font-weight: 300; letter-spacing: 2px; margin-bottom: 50px; color: var(--primary-color); text-align: center; line-height: 1.5; }
        .auth-btn { width: 80%; background-color: var(--card-bg); color: #fff; border: 1px solid var(--primary-color); padding: 15px; border-radius: 10px; font-size: 16px; margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-sizing: border-box; }

        /* 안면인식 UI */
        .camera-container { position: relative; width: 240px; height: 240px; border-radius: 50%; overflow: hidden; border: 2px solid var(--primary-color); margin-bottom: 20px; background: #1a1a1a; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        /* 매치 결과 팝업 */
        #match-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; flex-direction: column; align-items: center; justify-content: center; }
        .member-photo { width: 160px; height: 160px; border-radius: 50%; border: 3px solid var(--primary-color); object-fit: cover; margin-bottom: 20px; }

        /* 코드 입력 UI - 클릭 문제 해결 */
        .input-group { width: 80%; position: relative; display: flex; align-items: center; margin-bottom: 20px; z-index: 1600; }
        .code-input { width: 100%; background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 15px; font-size: 18px; border-radius: 10px; text-align: center; outline: none; pointer-events: auto; }
        .voice-btn { position: absolute; right: 10px; color: var(--primary-color); cursor: pointer; background: none; border: none; }

        /* --- 3. 메인 앱 화면 --- */
        #main-app { display: none; flex: 1; flex-direction: column; padding: 25px 20px; overflow-y: auto; padding-bottom: 150px; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-item { background-color: var(--card-bg); border-radius: 12px; height: 110px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; }
        .menu-item i { font-size: 30px; color: var(--primary-color); margin-bottom: 10px; }

        /* --- 4. 하단 영역 (Map & 저작권) --- */
        .bottom-area { position: absolute; bottom: 0; left: 0; width: 100%; background-color: #0a0a0a; border-top: 1px solid #222; z-index: 100; display: none; flex-direction: column; align-items: center; padding: 15px 0 20px 0; }
        .map-btn { display: flex; flex-direction: column; align-items: center; color: var(--primary-color); cursor: pointer; margin-bottom: 10px; }
        .copyright { font-size: 10px; color: #666; text-align: center; line-height: 1.5; }

        /* 서브화면 공통 */
        .sub-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 500; padding: 25px 20px; box-sizing: border-box; flex-direction: column; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="auth-selection-screen">
        <div class="logo-intro">BANYAN TREE<br><span style="font-size:14px; color:#aaa;">BUSAN HAEUNDAE</span></div>
        <button class="auth-btn" onclick="openFaceAuth()"><i class="material-icons">face</i>안면인식 로그인</button>
        <button class="auth-btn" onclick="openCodeAuth()"><i class="material-icons">vpn_key</i>인증 코드로 로그인</button>
    </div>

    <div id="security-screen">
        <div class="logo-intro">FACE ID SCANNING</div>
        <div class="camera-container">
            <video id="video-feed" playsinline muted></video>
            <div class="scan-line"></div>
        </div>
        <div id="face-status" style="color:var(--primary-color); text-align:center; font-size:14px;">정면을 응시해 주세요</div>
        <button class="auth-btn" style="background:none; border:none; color:#666; margin-top:20px;" onclick="location.reload()">취소</button>
        
        <div id="match-overlay">
            <img id="member-photo" src="https://docs.google.com/spreadsheets/d/1X1O3wvZ2j_sUeJSifv0Uiex55kAzFEhtZ5vgTlgmIwY/edit#gid=0" onerror="this.src='https://via.placeholder.com/150/8E7958/FFFFFF?text=MEMBER'" class="member-photo">
            <div id="match-rate-text" style="font-size:24px; font-weight:bold; color:white; margin-bottom:5px;"></div>
            <div id="match-desc-text" style="font-size:18px; color:var(--primary-color); margin-bottom:30px;"></div>
            <button id="match-action-btn" class="auth-btn" onclick="handleMatchResult()"></button>
        </div>
    </div>

    <div id="code-auth-screen">
        <div class="logo-intro">ENTER PASSCODE</div>
        <div class="input-group">
            <input type="text" id="access-code" class="code-input">
            <button class="voice-btn" onclick="startVoiceRecognition('access-code')"><i class="material-icons">mic</i></button>
        </div>
        <button class="auth-btn" onclick="verifyCode()" style="background:var(--primary-color)">로그인</button>
        <div style="margin-top:20px; color:#666; cursor:pointer;" onclick="location.reload()">뒤로 가기</div>
    </div>

    <div id="main-app">
        <div class="hotel-name">Banyantree Busan Haeundae</div>
        <div class="welcome-text">반갑습니다, 회원님.<br><b>어떤 서비스를 도와드릴까요?</b></div>
        <div class="menu-grid">
            <div class="menu-item" onclick="showSubScreen('concierge')"><i class="material-icons">room_service</i><span>Concierge<br>Service</span></div>
            <div class="menu-item" onclick="showSubScreen('hotel')"><i class="material-icons">apartment</i><span>Hotel<br>Service</span></div>
            <div class="menu-item" onclick="window.open('https://www.banyantree.com/booking', '_blank')"><i class="material-icons">event_available</i><span>Member<br>Booking</span></div>
            <div class="menu-item" onclick="checkLocationForValet()"><i class="material-icons">directions_car</i><span>Valet<br>Parking</span></div>
        </div>
    </div>

    <div class="bottom-area" id="bottom-area">
        <div class="map-btn" onclick="window.open('https://drive.google.com/file/d/1ICKC21t37n6B5ek9WQc_NNsLAfjAFfMo/view?usp=drive_link', '_blank')">
            <i class="material-icons">map</i>
            <span>Hotel Map</span>
        </div>
        <div class="copyright">
            © Banyan Tree Hotels & Resorts. All rights reserved.
        </div>
    </div>
</div>

<script>
    let streamRef = null;
    let isMatchValid = false;

    // 초기 화면 제어
    function openFaceAuth() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('security-screen').style.display = 'flex';
        initCamera();
    }

    function openCodeAuth() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'flex';
        document.getElementById('access-code').focus();
    }

    // 코드 인증 로직 (4가지 케이스)
    function verifyCode() {
        const input = document.getElementById('access-code').value.trim().toLowerCase();
        const validCodes = ["foryou", "for you", "포유", "포 유"];
        if (validCodes.includes(input)) { loginSuccess(); } 
        else { alert("인증 코드가 일치하지 않습니다."); }
    }

    // 안면인식 카메라 초기화
    async function initCamera() {
        try {
            streamRef = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.getElementById('video-feed');
            video.srcObject = streamRef;
            video.play();
            
            // 3초 후 시뮬레이션 결과 (실제 DB 연동은 서버 필요)
            setTimeout(processFaceMatch, 3000);
        } catch (e) { alert("카메라 권한이 필요합니다."); location.reload(); }
    }

    function processFaceMatch() {
        const rate = Math.floor(Math.random() * (85 - 62 + 1)) + 62; // 62~85 사이 랜덤 생성
        const overlay = document.getElementById('match-overlay');
        const rateText = document.getElementById('match-rate-text');
        const descText = document.getElementById('match-desc-text');
        const actionBtn = document.getElementById('match-action-btn');

        overlay.style.display = 'flex';
        rateText.innerText = `매치율 ${rate}%`;

        if (rate >= 70) {
            isMatchValid = true;
            descText.innerText = "“유력함”";
            actionBtn.innerText = "로그인 완료";
            actionBtn.style.backgroundColor = "var(--primary-color)";
        } else {
            isMatchValid = false;
            descText.innerText = "“추정됨”";
            actionBtn.innerText = "재시도";
            actionBtn.style.backgroundColor = "#555";
        }
    }

    function handleMatchResult() {
        if (isMatchValid) { loginSuccess(); } 
        else { location.reload(); }
    }

    function loginSuccess() {
        if(streamRef) streamRef.getTracks().forEach(t => t.stop());
        document.getElementById('security-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'none';
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('bottom-area').style.display = 'flex';
    }

    // 기타 보조 함수
    function showSubScreen(id) { /* 서브화면 로직 */ }
    function checkLocationForValet() { /* 위치기반 로직 */ alert("호텔 내에서 사용 가능합니다."); }
    function startVoiceRecognition(id) { /* STT 로직 */ }
</script>
</body>
</html>