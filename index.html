<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Banyan Tree Busan Concierge</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        :root { --primary-color: #8E7958; --bg-color: #121212; --card-bg: #1E1E1E; --text-color: #FFFFFF; }
        
        body { margin: 0; padding: 0; background-color: #000; font-family: 'Noto Sans KR', sans-serif; color: var(--text-color); -webkit-tap-highlight-color: transparent; overflow: hidden; }
        
        #app-container { max-width: 480px; margin: 0 auto; background-color: var(--bg-color); height: 100vh; position: relative; display: flex; flex-direction: column; }

        /* --- ë¡œê·¸ì¸/ì¸ì¦ ì„¹ì…˜ (ìµœìƒë‹¨ ë ˆì´ì–´) --- */
        #auth-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: #000; }
        .auth-screen { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; position: absolute; top: 0; left: 0; }
        
        .logo-intro { font-size: 22px; font-weight: 300; letter-spacing: 2px; margin-bottom: 50px; color: var(--primary-color); text-align: center; line-height: 1.5; }
        
        .auth-btn { width: 80%; background-color: var(--card-bg); color: #fff; border: 1px solid var(--primary-color); padding: 18px; border-radius: 12px; font-size: 16px; margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; z-index: 2100; }

        /* --- ì•ˆë©´ ì¸ì‹ UI --- */
        .camera-container { position: relative; width: 260px; height: 260px; border-radius: 50%; overflow: hidden; border: 2px solid var(--primary-color); margin-bottom: 20px; background: #1a1a1a; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        #match-popup { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .member-photo { width: 150px; height: 150px; border-radius: 50%; border: 3px solid var(--primary-color); margin-bottom: 20px; object-fit: cover; }

        /* --- ì½”ë“œ ì…ë ¥ UI (í´ë¦­ ì´ìŠˆ í•´ê²°) --- */
        .input-group { width: 80%; position: relative; display: flex; align-items: center; margin-bottom: 25px; z-index: 2500; }
        .code-input { width: 100%; background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 18px; font-size: 18px; border-radius: 12px; text-align: center; outline: none; }
        .code-input:focus { border-color: var(--primary-color); }
        .voice-btn { position: absolute; right: 15px; color: var(--primary-color); cursor: pointer; background: none; border: none; font-size: 24px; }

        /* --- ë©”ì¸ í™ˆ í™”ë©´ --- */
        #main-app { display: none; flex: 1; flex-direction: column; padding: 25px 20px; overflow-y: auto; }
        .hotel-name { font-size: 18px; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        .welcome-text { font-size: 20px; margin-bottom: 30px; line-height: 1.4; font-weight: 300; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .menu-item { background-color: var(--card-bg); border-radius: 15px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; transition: 0.3s; }
        .menu-item:active { transform: scale(0.95); background-color: #2a2a2a; }
        .menu-item i { font-size: 35px; color: var(--primary-color); margin-bottom: 10px; }
        .menu-item span { font-size: 14px; text-align: center; color: #eee; font-weight: 500; }

        /* --- ì„œë¸Œ ìŠ¤í¬ë¦° --- */
        .sub-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 500; padding: 25px 20px; box-sizing: border-box; flex-direction: column; }
        .screen-header { display: flex; align-items: center; margin-bottom: 25px; font-size: 18px; font-weight: bold; color: var(--primary-color); }
        .screen-header i { margin-right: 15px; cursor: pointer; }

        /* --- í•˜ë‹¨ ë°” ë° ì €ì‘ê¶Œ --- */
        #footer-area { background-color: #0a0a0a; border-top: 1px solid #222; padding: 15px 0 25px 0; display: flex; flex-direction: column; align-items: center; }
        .map-trigger { color: var(--primary-color); display: flex; flex-direction: column; align-items: center; cursor: pointer; margin-bottom: 15px; }
        .map-trigger i { font-size: 28px; }
        .copyright-text { font-size: 10px; color: #555; text-align: center; line-height: 1.5; padding: 0 20px; }

        /* ë°”í…€ ì‹œíŠ¸ (4 Season Tour) */
        #bottom-sheet-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1200; }
        #bottom-sheet { position: absolute; bottom: -100%; left: 0; width: 100%; background-color: #1a1a1a; border-radius: 25px 25px 0 0; z-index: 1201; transition: bottom 0.3s ease; padding: 25px; box-sizing: border-box; }
        .sub-list-item { padding: 20px 0; border-bottom: 1px solid #2a2a2a; display: flex; justify-content: space-between; color: #ddd; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="auth-overlay">
        <div id="auth-main" class="auth-screen">
            <div class="logo-intro">BANYAN TREE<br><span style="font-size:14px; color:#aaa;">BUSAN HAEUNDAE</span></div>
            <button class="auth-btn" onclick="showAuthStep('face')"><i class="material-icons">face</i>ì•ˆë©´ì¸ì‹ ë¡œê·¸ì¸</button>
            <button class="auth-btn" onclick="showAuthStep('code')"><i class="material-icons">vpn_key</i>ì¸ì¦ ì½”ë“œë¡œ ë¡œê·¸ì¸</button>
        </div>

        <div id="auth-face" class="auth-screen" style="display:none;">
            <div class="logo-intro">FACE ID VERIFICATION</div>
            <div class="camera-container">
                <video id="video-feed" playsinline muted></video>
                <div class="scan-line" id="scan-bar"></div>
            </div>
            <div id="face-status" style="color:var(--primary-color); text-align:center; font-size:14px; height:40px;">ì¹´ë©”ë¼ ëª¨ë¸ ë¡œë”© ì¤‘...</div>
            <button class="auth-btn" style="background:none; border:none; color:#666;" onclick="location.reload()">ì·¨ì†Œ í›„ ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="auth-code" class="auth-screen" style="display:none;">
            <div class="logo-intro">MEMBER ACCESS</div>
            <div class="input-group">
                <input type="text" id="access-code" class="code-input" placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="voice-btn" onclick="startSTT('access-code')"><i class="material-icons">mic</i></button>
            </div>
            <button class="auth-btn" style="background:var(--primary-color)" onclick="checkCode()">ì ‘ì†í•˜ê¸°</button>
            <button class="auth-btn" style="background:none; border:none; color:#666;" onclick="location.reload()">ë’¤ë¡œ ê°€ê¸°</button>
        </div>

        <div id="match-popup">
            <img id="member-photo" src="https://via.placeholder.com/150/8E7958/FFFFFF?text=MEMBER" class="member-photo">
            <div id="match-rate" style="font-size:24px; font-weight:bold; color:white; margin-bottom:5px;"></div>
            <div id="match-label" style="font-size:18px; color:var(--primary-color); margin-bottom:30px;"></div>
            <button id="match-btn" class="auth-btn" style="width:150px;"></button>
        </div>
    </div>

    <div id="main-app">
        <div class="hotel-name">Banyantree Busan Haeundae</div>
        <div class="welcome-text">ë°˜ê°‘ìŠµë‹ˆë‹¤, íšŒì›ë‹˜.<br><b>ì»¨ì‹œì–´ì§€ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</b></div>
        
        <div class="menu-grid">
            <div class="menu-item" onclick="openSub('concierge')"><i class="material-icons">room_service</i><span>Concierge<br>Service</span></div>
            <div class="menu-item" onclick="openSub('hotel')"><i class="material-icons">apartment</i><span>Hotel<br>Service</span></div>
            <div class="menu-item" onclick="window.open('https://www.banyantree.com/booking', '_blank')"><i class="material-icons">event_available</i><span>Member<br>Booking</span></div>
            <div class="menu-item" onclick="runValetCheck()"><i class="material-icons">directions_car</i><span>Valet<br>Parking</span></div>
        </div>

        <div id="footer-area">
            <div class="map-trigger" onclick="window.open('https://drive.google.com/file/d/1ICKC21t37n6B5ek9WQc_NNsLAfjAFfMo/view?usp=drive_link')">
                <i class="material-icons">map</i>
                <span>Hotel Map</span>
            </div>
            <div class="copyright-text">
                Â© Banyan Tree Hotels & Resorts. All rights reserved.<br>
                ë³¸ ì„œë¹„ìŠ¤ì˜ ëª¨ë“  ê¶Œí•œì€ ë°˜ì–€íŠ¸ë¦¬ ë¶€ì‚° í•´ìš´ëŒ€ì— ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <div id="sub-concierge" class="sub-screen">
        <div class="screen-header"><i class="material-icons" onclick="closeSub()">arrow_back</i>Concierge Service</div>
        <div class="menu-grid">
            <div class="menu-item" onclick="openTour()"><i class="material-icons">map</i><span>4 Season Tour</span></div>
            <div class="menu-item" onclick="alert('Kids ì „ìš© í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.')"><i class="material-icons">child_friendly</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('í”„ë¦¬ë¯¸ì—„ ì„¸ì°¨ ì˜ˆì•½ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.')"><i class="material-icons">local_car_wash</i><span>Car Wash</span></div>
            <div class="menu-item" onclick="alert('ì¸ê·¼ ê±°ì  ë³‘ì› ë° ì‘ê¸‰ì‹¤ ì •ë³´ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.')"><i class="material-icons">medical_services</i><span>Hospital<br>Information</span></div>
        </div>
    </div>

    <div id="sub-hotel" class="sub-screen">
        <div class="screen-header"><i class="material-icons" onclick="closeSub()">arrow_back</i>Hotel Service</div>
        <div class="menu-grid">
            <div class="menu-item" onclick="alert('Dining ì˜ˆì•½ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">restaurant</i><span>Dining</span></div>
            <div class="menu-item" onclick="alert('Lounge ì •ë³´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">local_bar</i><span>Lounge</span></div>
            <div class="menu-item" onclick="alert('Wellness & SPA ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">spa</i><span>Wellness</span></div>
            <div class="menu-item" onclick="alert('Facilities ì‹œì„¤ ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">pool</i><span>Facilities</span></div>
            <div class="menu-item" onclick="alert('Kids Club ì´ìš© ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">child_care</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('ì—°íšŒì¥ ë° ì›¨ë”© ìƒë‹´ ì˜ˆì•½ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">celebration</i><span>ì—°íšŒì¥ ë° ì›¨ë”©</span></div>
        </div>
    </div>

    <div id="sub-valet" class="sub-screen">
        <div class="screen-header"><i class="material-icons" onclick="closeSub()">arrow_back</i>Valet Service</div>
        <div style="text-align:center; padding:20px; color:#aaa; font-size:14px; line-height:1.6;">í˜¸í…” ë‚´ ì²´ë¥˜ ì¤‘ì¸ ê³ ê°ë‹˜ì„ ìœ„í•œ ì „ìš© ì¶œì°¨ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</div>
        <div class="input-group" style="width:100%;">
            <input type="text" id="car-num" class="code-input" placeholder="ì°¨ëŸ‰ë²ˆí˜¸ ì „ì²´ ì…ë ¥">
            <button class="voice-btn" onclick="startSTT('car-num')"><i class="material-icons">mic</i></button>
        </div>
        <button class="auth-btn" style="width:100%; background:var(--primary-color);" onclick="sendValet()">ì¶œì°¨ ìš”ì²­í•˜ê¸°</button>
    </div>

    <div id="bottom-sheet-overlay" onclick="closeTour()"></div>
    <div id="bottom-sheet">
        <div style="color:var(--primary-color); font-weight:bold; margin-bottom:15px; font-size:18px;">4 Season Tour Drive</div>
        <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1Ax4O2b49CM5I6-KnMebXjz9r8PHlgUmz/view')"><span>ğŸŒ¸ Spring Course</span><i class="material-icons">chevron_right</i></div>
        <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1m1nqU2eRtS4YHKAPKqYEekQn7KF0i_sp/view')"><span>ğŸŒŠ Summer Course</span><i class="material-icons">chevron_right</i></div>
        <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1d84lGgWJuSJUh3F-AJThTIq-B-t9usRd/view')"><span>ğŸ‚ Autumn Course</span><i class="material-icons">chevron_right</i></div>
        <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1YpcJG6XhzOfaR_e0iDOY0y2yXt5f0t8S/view')"><span>â„ï¸ Winter Course</span><i class="material-icons">chevron_right</i></div>
    </div>
</div>

<script>
    /* =========================================
       1. ì¸ì¦ ê´€ë¦¬ ë¡œì§
    ========================================= */
    const VALID_CODES = ["foryou", "for you", "í¬ìœ ", "í¬ ìœ "];
    let isFaceReady = false;
    let cameraStream = null;

    function showAuthStep(step) {
        document.getElementById('auth-main').style.display = 'none';
        if(step === 'code') {
            document.getElementById('auth-code').style.display = 'flex';
        } else if(step === 'face') {
            document.getElementById('auth-face').style.display = 'flex';
            initFaceAPI();
        }
    }

    function checkCode() {
        const val = document.getElementById('access-code').value.trim().toLowerCase();
        if(VALID_CODES.includes(val)) {
            grantAccess();
        } else {
            alert("ìœ íš¨í•˜ì§€ ì•Šì€ ì½”ë“œì…ë‹ˆë‹¤.");
        }
    }

    async function initFaceAPI() {
        const status = document.getElementById('face-status');
        try {
            status.innerText = "ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘...";
            // ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë¸ ë¡œë“œ (TinyFaceDetector)
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            status.innerText = "ì¹´ë©”ë¼ë¥¼ ì¼œëŠ” ì¤‘...";
            
            cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.getElementById('video-feed');
            video.srcObject = cameraStream;
            video.play();
            
            isFaceReady = true;
            status.innerText = "ì–¼êµ´ì„ ì •ë©´ì— ë§ì¶°ì£¼ì„¸ìš”.";
            
            // ì‹¤ì œ ì•ˆë©´ ì¸ì‹ ë£¨í”„ ì‹œì‘
            const detectionLoop = setInterval(async () => {
                if(!isFaceReady) return;
                
                const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions());
                
                if(detections.length > 0) {
                    // ì–¼êµ´ì´ ì‹¤ì œë¡œ ë°œê²¬ë¨! -> ë§¤ì¹˜ìœ¨ ë¡œì§ ì§„í–‰
                    clearInterval(detectionLoop);
                    processMatchResult();
                }
            }, 1000);

        } catch (err) {
            status.innerText = "ì¹´ë©”ë¼ ê¶Œí•œ ì˜¤ë¥˜ ë˜ëŠ” HTTPS í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤.";
        }
    }

    function processMatchResult() {
        // ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” ì—¬ê¸°ì„œ ì„œë²„ ì „ì†¡ í›„ ëŒ€ì¡° ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ì§€ë§Œ, 
        // ìš”ì²­í•˜ì‹  ëŒ€ë¡œ êµ¬ê¸€ ë“œë¼ì´ë¸Œ DB ëŒ€ì¡° ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
        const video = document.getElementById('video-feed');
        video.pause();
        
        // 62~85 ì‚¬ì´ì˜ ëœë¤ ë§¤ì¹˜ìœ¨ ìƒì„±
        const rate = Math.floor(Math.random() * (85 - 62 + 1)) + 62;
        const popup = document.getElementById('match-popup');
        const rateText = document.getElementById('match-rate');
        const labelText = document.getElementById('match-label');
        const btn = document.getElementById('match-btn');

        popup.style.display = 'flex';
        rateText.innerText = `ë§¤ì¹˜ìœ¨ ${rate}%`;

        if(rate >= 70) {
            labelText.innerText = "â€œìœ ë ¥í•¨â€";
            btn.innerText = "ì ‘ì† ì™„ë£Œ";
            btn.style.backgroundColor = "var(--primary-color)";
            btn.onclick = grantAccess;
        } else {
            labelText.innerText = "â€œì¶”ì •ë¨â€";
            btn.innerText = "ì¬ì‹œë„";
            btn.style.backgroundColor = "#555";
            btn.onclick = () => location.reload();
        }
    }

    function grantAccess() {
        if(cameraStream) cameraStream.getTracks().forEach(t => t.stop());
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
    }

    /* =========================================
       2. ë©”ë‰´ ë° í™”ë©´ ì œì–´
    ========================================= */
    function openSub(id) {
        document.getElementById('main-app').style.display = 'none';
        document.getElementById('sub-' + id).style.display = 'flex';
    }

    function closeSub() {
        document.querySelectorAll('.sub-screen').forEach(s => s.style.display = 'none');
        document.getElementById('main-app').style.display = 'flex';
    }

    function openTour() {
        document.getElementById('bottom-sheet-overlay').style.display = 'block';
        setTimeout(() => document.getElementById('bottom-sheet').style.bottom = '0', 50);
    }

    function closeTour() {
        document.getElementById('bottom-sheet').style.bottom = '-100%';
        setTimeout(() => document.getElementById('bottom-sheet-overlay').style.display = 'none', 300);
    }

    /* =========================================
       3. ë¶€ê°€ ê¸°ëŠ¥ (STT, Valet)
    ========================================= */
    function startSTT(targetId) {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ko-KR';
        recognition.start();
        recognition.onresult = (e) => {
            document.getElementById(targetId).value = e.results[0][0].transcript;
        };
    }

    function runValetCheck() {
        // ë‹¬ë§ì´ ë§¥ë„ë‚ ë“œ(ê±°ì ) ê¸°ì¤€ ì•½ 1km ë°˜ê²½ ì‹œë®¬ë ˆì´ì…˜
        navigator.geolocation.getCurrentPosition((pos) => {
            const lat = pos.coords.latitude;
            if(lat > 35.15 && lat < 35.17) {
                openSub('valet');
            } else {
                alert("ë³¸ ì„œë¹„ìŠ¤ëŠ” í˜¸í…” ë‚´ ì²´ë¥˜ ê³ ê°ë‹˜ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            }
        }, () => alert("ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."));
    }

    function sendValet() {
        const num = document.getElementById('car-num').value;
        if(!num) return alert("ì°¨ëŸ‰ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        window.open(`https://wa.me/821050280073?text=ë°œë ›ìš”ì²­:${encodeURIComponent(num)}`, '_blank');
    }
</script>
</body>
</html>