<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Banyan Tree Busan Concierge</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        :root { --primary-color: #8E7958; --bg-color: #121212; --card-bg: #1E1E1E; --text-color: #FFFFFF; }
        body { margin: 0; padding: 0; background-color: #000; font-family: 'Noto Sans KR', sans-serif; color: var(--text-color); overflow: hidden; }
        #app-container { max-width: 480px; margin: 0 auto; background-color: var(--bg-color); height: 100vh; position: relative; display: flex; flex-direction: column; }
        
        /* 인증 레이어 */
        #auth-overlay { position: absolute; inset: 0; z-index: 2000; background: #000; }
        .auth-screen { 
            width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: flex-start; 
            padding-top: 15vh; 
            position: absolute; inset: 0; 
            box-sizing: border-box;
        }
        .logo-intro { font-size: 22px; font-weight: 300; letter-spacing: 2px; margin-bottom: 40px; color: var(--primary-color); text-align: center; }
        .auth-btn { width: 80%; background-color: var(--card-bg); color: #fff; border: 1px solid var(--primary-color); padding: 18px; border-radius: 12px; font-size: 16px; margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* 안면 인식 UI */
        .camera-container { position: relative; width: 280px; height: 280px; border-radius: 50%; overflow: hidden; border: 3px solid var(--primary-color); margin-bottom: 20px; background: #1a1a1a; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
        #face-status { color: var(--primary-color); text-align: center; font-size: 14px; margin-bottom: 10px; }
        #debug-log { width: 80%; height: 60px; font-size: 10px; color: #666; overflow-y: auto; text-align: left; background: #000; padding: 5px; border-radius: 5px; font-family: monospace; }

        /* 메인 앱 및 메뉴 */
        #main-app { display: none; flex: 1; flex-direction: column; padding: 25px 20px; overflow-y: auto; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-item { background-color: var(--card-bg); border-radius: 15px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #333; cursor: pointer; text-align: center; padding: 5px; }
        .menu-item i { font-size: 35px; color: var(--primary-color); margin-bottom: 10px; }
        .footer { margin-top: auto; padding: 20px 0; text-align: center; font-size: 11px; color: #555; letter-spacing: 1px; }
        
        .sub-screen { display: none; position: absolute; inset: 0; background-color: var(--bg-color); z-index: 500; padding: 25px 20px; flex-direction: column; overflow-y: auto; }
        .back-btn { color: var(--primary-color); display: flex; align-items: center; cursor: pointer; margin-bottom: 20px; }
        
        .input-group { position: relative; width: 80%; margin-bottom: 20px; align-self: center; }
        .styled-input { width: 100%; padding: 15px; padding-right: 50px; background:#1a1a1a; color:#fff; border:1px solid #444; border-radius:10px; text-align:center; box-sizing: border-box; font-size: 16px; }
        .mic-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: var(--primary-color); cursor: pointer; }

        #bottom-sheet-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; }
        #bottom-sheet { display: none; position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: #1a1a1a; border-radius: 20px 20px 0 0; padding: 30px 20px; z-index: 1001; box-sizing: border-box; transition: transform 0.3s ease; }
        .sub-list-item { display: flex; justify-content: space-between; align-items: center; padding: 18px; background: #252525; border-radius: 10px; margin-bottom: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="auth-overlay">
        <div id="auth-main" class="auth-screen">
            <div class="logo-intro">BANYAN TREE<br><span style="font-size:14px; color:#aaa;">BUSAN HAEUNDAE</span></div>
            <button class="auth-btn" onclick="showAuthStep('face')"><i class="material-icons">face</i>안면인식 로그인</button>
            <button class="auth-btn" onclick="showAuthStep('code')"><i class="material-icons">vpn_key</i>인증 코드로 로그인</button>
            
            <div style="position:absolute; bottom:12vh; width:90%; font-size:11px; color:#666; text-align:center; line-height:1.6;">
                반얀트리 부산 회원을 위한 Exclusive Service 입니다.<br>서비스 이용 시 모바일 데이터가 발생 될 수 있습니다.
            </div>
        </div>

        <div id="auth-face" class="auth-screen" style="display:none; padding-top: 8vh;">
            <div style="width:85%; font-size:12px; color:var(--primary-color); text-align:center; margin-bottom:20px; line-height:1.5;">
                해당 서비스는 호텔의 개인정보 이용 방침에 사전 동의하신 분만 <br> 안면 인식 로그인을 이용해 주시기 바랍니다.
            </div>
            <div class="camera-container">
                <video id="video-feed" autoplay muted playsinline></video>
                <div class="scan-line"></div>
            </div>
            <div id="face-status">시스템 부팅 중</div>
            <div id="debug-log"></div>
            
            <button id="start-matching-btn" class="auth-btn" style="background:var(--primary-color); margin-top:10px;" onclick="beginFaceRecognition()">안면인식 시작</button>
            <button class="auth-btn" style="background:none; border:none; color:#666; margin-top:5px;" onclick="location.reload()">뒤로가기</button>
        </div>

        <div id="auth-code" class="auth-screen" style="display:none;">
            <div class="logo-intro" style="font-size:18px;">ENTER ACCESS CODE</div>
            <div class="input-group">
                <input type="text" id="access-code" class="styled-input" placeholder="코드를 입력하세요">
                <i class="material-icons mic-btn" onclick="startVoiceRecognition('access-code')">mic</i>
            </div>
            <button class="auth-btn" style="background:var(--primary-color)" onclick="checkCode()">접속</button>
            <button class="auth-btn" style="background:none; border:none; color:#666;" onclick="location.reload()">뒤로가기</button>
        </div>
    </div>

    <div id="main-app">
        <div style="color:var(--primary-color); font-weight:bold; margin-bottom:5px;">Banyan Tree Busan</div>
        <div style="font-size:22px; margin-bottom:30px; font-weight:300;">반갑습니다, <b id="user-name">회원</b>님.</div>
        
        <div class="menu-grid">
            <div class="menu-item" onclick="openSub('concierge')"><i class="material-icons">room_service</i><span>Concierge</span></div>
            <div class="menu-item" onclick="openSub('hotel')"><i class="material-icons">apartment</i><span>Hotel Service</span></div>
            <div class="menu-item" onclick="window.open('https://www.banyantree.com', '_blank')"><i class="material-icons">event_available</i><span>Booking</span></div>
            <div class="menu-item" onclick="openSub('valet')"><i class="material-icons">directions_car</i><span>Valet</span></div>
        </div>
        <div class="footer">COPYRIGHT © BANYAN TREE BUSAN. ALL RIGHTS RESERVED.</div>
    </div>

    <div id="sub-concierge" class="sub-screen">
        <div class="back-btn" onclick="closeSub()"><i class="material-icons">arrow_back</i> 뒤로가기</div>
        <h2 style="margin-bottom:25px;">Concierge Service</h2>
        <div class="menu-grid">
            <div class="menu-item" onclick="openTour()"><i class="material-icons">map</i><span>4 Season Tour</span></div>
            <div class="menu-item" onclick="alert('Kids 서비스 준비 중')"><i class="material-icons">child_friendly</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('세차 예약 서비스')"><i class="material-icons">local_car_wash</i><span>Car Wash</span></div>
            <div class="menu-item" onclick="window.open('https://www.e-gen.or.kr/egen/egenmain.do', '_blank')"><i class="material-icons">medical_services</i><span>Hospital</span></div>
        </div>
    </div>

    <div id="sub-hotel" class="sub-screen">
        <div class="back-btn" onclick="closeSub()"><i class="material-icons">arrow_back</i> 뒤로가기</div>
        <h2 style="margin-bottom:25px;">Hotel Service</h2>
        <div class="menu-grid">
            <div class="menu-item" onclick="alert('홈페이지 구축 후 링크 연결 예정입니다.')"><i class="material-icons">restaurant</i><span>Dining</span></div>
            <div class="menu-item" onclick="alert('홈페이지 구축 후 링크 연결 예정입니다.')"><i class="material-icons">local_bar</i><span>Lounge</span></div>
            <div class="menu-item" onclick="alert('홈페이지 구축 후 링크 연결 예정입니다.')"><i class="material-icons">spa</i><span>Wellness</span></div>
            <div class="menu-item" onclick="alert('홈페이지 구축 후 링크 연결 예정입니다.')"><i class="material-icons">pool</i><span>Facilities</span></div>
            <div class="menu-item" onclick="alert('홈페이지 구축 후 링크 연결 예정입니다.')"><i class="material-icons">child_care</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('홈페이지 구축 후 링크 연결 예정입니다.')">